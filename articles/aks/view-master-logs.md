---
title: View Azure Kubernetes Service (AKS) controller logs
description: Learn how to enable and view the logs for the Kubernetes master node in Azure Kubernetes Service (AKS)
services: container-service
author: iainfoulds

ms.service: container-service
ms.topic: article
ms.date: 07/25/2018
ms.author: iainfou
---

# Enable and review Kubernetes master node logs in Azure Kubernetes Service (AKS)

With Azure Kubernetes Service (AKS), the master components such as the *kube-apiserver* and *kube-controller-manager* are provided as a managed service. You create and manage the nodes that run the *kubelet* and container runtime, and deploy your applications through the managed Kubernetes API server. To help troubleshoot your application and services, you can view the logs generated by these master components. This article shows you how to use Azure Log Analytics to enable and query the logs from the Kubernetes master components.

## Before you begin

This article requires an existing AKS cluster running in your Azure account. If you do not already have an AKS cluster, create one using the [Azure CLI][cli-quickstart] or [Azure portal][portal-quickstart]. Log Analytics works for both RBAC-enabled and non-RBAC enabled AKS clusters.

## Enable diagnostics logs

In the Azure portal

* Select the resource group for your AKS cluster, such as *myResourceGroup*.
* On the left-hand side, choose **Diagnostic settings**.
* Select your AKS cluster, such as *myAKSCluster*, then choose to **Turn on diagnostics**.
* Enter a name, such as *myAKSLogs*.
* There are three options for storing diagnostic logs. In this example, select the option to **Send to Log Analytics**.
* Choose to *Configure* Log Analytics, then select or **Create New Workspace**.
    * If you need to create a workspace, provide a name, a resource group, and a location.
* In the list of available logs, select the logs you wish to enable, such as *kube-apiserver*, *kube-controller-manager*, and *kube-scheduler*. If you need to change the collected logs, you can return and edit the collected logs once Log Analytics are enabled.
* When ready, select **Save** to enable collection of the selected logs.

The following example portal screenshot shows the step to create an OMS workspace and

![Enable OMS workspace for Log Analytics of AKS cluster](media/view-master-logs/enable-oms-log-analytics.png)

# Schedule a test pod on the AKS cluster

To generate some logs, create a new pod in your AKS cluster. The following example YAML manifest can be used to create a basic NGINX instance. Create a file named `nginx.yaml` in an editor of your choice and paste the following content:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx:1.7.9
    ports:
    - containerPort: 80
```

Now create the pod with `kubectl create` and specify your YAML file, as shown in the following example output:

```
$ kubectl create -f nginx.yaml

pod/nginx created
```

## View collected logs

It may take a few minutes for the diagnotics logs to be enabled and to then appear in the OMS workspace. In the Azure portal, select your resource group, such as *myReosurceGroup*, then choose your Log Analytics resource, such as *myAKSLogs*.

![Select the Log Analytics workspace for your AKS cluster](media/view-master-logs/select-log-analytics-workspace.png)

On the left-hand side, choose **Log Search**. To view the *kube-controller-logs*, enter the following query in the text box:

```
search *
| where Type == "AzureDiagnostics"
| where Category == "kube-apiserver"
| project log_s
```

A lot of logs are likely returned for the API server. To scope down the query to view the logs about the NGINX pod created in the previous step, add an additional *where* statement to search for *pods/nginx* as shown in the following example query:

```
search *
| where Type == "AzureDiagnostics"
| where Category == "kube-apiserver"
| where log_s contains "pods/nginx"
| project log_s
```

The logs specific to your NGINX pod are displayed, as shown in the following example screenshot:

![Log Analytics query results for sample NGINX pod](media/view-master-logs/log-analytics-query-results.png)

To view additional logs, change the *Category* name to *kube-apiserver* or *kube-scheduler*, depending on what additional logs you enable.

## Next steps

<!-- LINKS - external -->

<!-- LINKS - internal -->
[cli-quickstart]: kubernetes-walkthrough.md
[portal-quickstart]: kubernetes-walkthrough-portal.md